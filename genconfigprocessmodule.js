// Generated by CoffeeScript 2.4.1
(function() {
  var fs, genconfigprocessmodule, log, nginxConf, pathHandler, processAllThingies;

  genconfigprocessmodule = {
    name: "genconfigprocessmodule"
  };

  //region node_modules
  fs = require("fs");

  //endregion

  //log Switch
  log = function(arg) {
    if (allModules.debugmodule.modulesToDebug["genconfigprocessmodule"] != null) {
      console.log("[genconfigprocessmodule]: " + arg);
    }
  };

  //region internal variables
  pathHandler = null;

  nginxConf = null;

  //endregion

  //#initialization function  -> is automatically being called!  ONLY RELY ON DOM AND VARIABLES!! NO PLUGINS NO OHTER INITIALIZATIONS!!
  genconfigprocessmodule.initialize = function() {
    log("genconfigprocessmodule.initialize");
    pathHandler = allModules.pathhandlermodule;
    return nginxConf = allModules.nginxconfigmodule;
  };

  //region internal functions
  processAllThingies = async function() {
    var config, promises, requirePath, thingy;
    log("processAllThingies");
    requirePath = pathHandler.getConfigRequirePath();
    config = require(requirePath);
    promises = (function() {
      var i, len, ref, results;
      ref = config.thingies;
      results = [];
      for (i = 0, len = ref.length; i < len; i++) {
        thingy = ref[i];
        results.push(nginxConf.generateForThingy(thingy));
      }
      return results;
    })();
    return (await Promise.all(promises));
  };

  
  //endregion

  //region exposed functions
  genconfigprocessmodule.execute = async function(configPath, outputDirectory) {
    log("genconfigprocessmodule.execute");
    await pathHandler.setConfigFilePath(configPath);
    await pathHandler.setOutputDirectory(outputDirectory);
    await processAllThingies();
    return true;
  };

  //endregion
  module.exports = genconfigprocessmodule;

}).call(this);
